# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

apiVersion: uds.dev/v1alpha1
kind: Package
metadata:
  name: socketzero
  namespace: {{ .Release.Namespace }}
spec:
  {{- if .Values.sso.enabled }}
  sso:
    - name: SocketZero Login
      clientId: uds-package-socketzero
      redirectUris:
        - "https://socketzero.{{ .Values.domain }}/login"
      secretName: {{ .Values.sso.secretName }}
      enableAuthserviceSelector:
        app: socketzero
  {{- end }}
  # Customize network policies and expose services via istio
  network:
    expose:
      - service: socketzero
        podLabels:
          app: socketzero
        gateway: tenant
        host: socketzero
        port: 9997
    allow:
      - direction: Ingress
        remoteGenerated: IntraNamespace

      - direction: Egress
        remoteGenerated: IntraNamespace

      # Custom rules for unanticipated scenarios
      {{- with .Values.additionalNetworkAllow }}
      {{ toYaml . | nindent 6 }}
      {{- end }}
